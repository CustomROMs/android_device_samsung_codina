From a56dbc467f6bceb3fe81541abb676e4563f638f0 Mon Sep 17 00:00:00 2001
From: maxwen <max.weninger@gmail.com>
Date: Sat, 9 Dec 2017 03:06:19 +0100
Subject: [PATCH 4/6] soong: add TARGET_SPECIFIC_HEADER_PATH to config

Change-Id: I30f454a7eebedc8c537418d8594da8e309a80c02
---
 android/config.go   | 4 ++++
 android/variable.go | 1 +
 cc/library.go       | 3 +++
 3 files changed, 8 insertions(+)

diff --git a/android/config.go b/android/config.go
index 906d8f6d..d6a75e99 100644
--- a/android/config.go
+++ b/android/config.go
@@ -859,3 +859,7 @@ func stringSlice(s *[]string) []string {
 		return nil
 	}
 }
+
+func (c *deviceConfig) TargetHeaderPathDir() string {
+	return String(c.config.ProductVariables.TargetHeaderPath)
+}
diff --git a/android/variable.go b/android/variable.go
index 6af4f7e1..4a739565 100644
--- a/android/variable.go
+++ b/android/variable.go
@@ -225,6 +225,7 @@ type productVariables struct {
 
 	Override_rs_driver *string `json:",omitempty"`
 
+	TargetHeaderPath *string `json:",omitempty"`
 	DeviceKernelHeaders []string `json:",omitempty"`
 	DistDir             *string  `json:",omitempty"`
 
diff --git a/cc/library.go b/cc/library.go
index 76f8a8cf..fe78a33d 100644
--- a/cc/library.go
+++ b/cc/library.go
@@ -319,6 +319,9 @@ func (library *libraryDecorator) linkerFlags(ctx ModuleContext, flags Flags) Fla
 }
 
 func (library *libraryDecorator) compilerFlags(ctx ModuleContext, flags Flags, deps PathDeps) Flags {
+	if len(ctx.DeviceConfig().TargetHeaderPathDir()) > 0 {
+		flags.GlobalFlags = append(flags.GlobalFlags, "-I" + ctx.DeviceConfig().TargetHeaderPathDir())
+	}
 	exportIncludeDirs := library.flagExporter.exportedIncludes(ctx)
 	if len(exportIncludeDirs) > 0 {
 		f := includeDirsToFlags(exportIncludeDirs)
-- 
2.11.0

