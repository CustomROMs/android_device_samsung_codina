From d49fa34ce077d5f8c9bba19dad5a833b8f9ad6f6 Mon Sep 17 00:00:00 2001
From: maxwen <max.weninger@gmail.com>
Date: Sat, 9 Dec 2017 03:06:19 +0100
Subject: [PATCH 15/16] soong: add TARGET_SPECIFIC_HEADER_PATH to config

Change-Id: I30f454a7eebedc8c537418d8594da8e309a80c02
---
 android/config.go   | 4 ++++
 android/variable.go | 1 +
 cc/library.go       | 3 +++
 3 files changed, 8 insertions(+)

diff --git a/android/config.go b/android/config.go
index 3f78110b..9ff3d20e 100644
--- a/android/config.go
+++ b/android/config.go
@@ -860,3 +860,7 @@ func stringSlice(s *[]string) []string {
 		return nil
 	}
 }
+
+func (c *deviceConfig) TargetHeaderPathDir() string {
+	return String(c.config.productVariables.TargetHeaderPath)
+}
diff --git a/android/variable.go b/android/variable.go
index 53dd9437..f484377d 100644
--- a/android/variable.go
+++ b/android/variable.go
@@ -216,6 +216,7 @@ type productVariables struct {
 
 	Product_is_iot *bool `json:",omitempty"`
 
+	TargetHeaderPath *string `json:",omitempty"`
 	DeviceKernelHeaders []string `json:",omitempty"`
 	DistDir             *string  `json:",omitempty"`
 
diff --git a/cc/library.go b/cc/library.go
index e92cf9d1..f7f9149c 100644
--- a/cc/library.go
+++ b/cc/library.go
@@ -320,6 +320,9 @@ func (library *libraryDecorator) linkerFlags(ctx ModuleContext, flags Flags) Fla
 }
 
 func (library *libraryDecorator) compilerFlags(ctx ModuleContext, flags Flags, deps PathDeps) Flags {
+	if len(ctx.DeviceConfig().TargetHeaderPathDir()) > 0 {
+		flags.GlobalFlags = append(flags.GlobalFlags, "-I" + ctx.DeviceConfig().TargetHeaderPathDir())
+	}
 	exportIncludeDirs := library.flagExporter.exportedIncludes(ctx)
 	if len(exportIncludeDirs) > 0 {
 		f := includeDirsToFlags(exportIncludeDirs)
-- 
2.17.0

