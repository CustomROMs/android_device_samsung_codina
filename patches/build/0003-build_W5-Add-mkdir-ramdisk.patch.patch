From f593dee00c7691b43fa79a4a4ebcda56adbd2b6d Mon Sep 17 00:00:00 2001
From: Shilin Victor <radicaldreamer00001@gmail.com>
Date: Fri, 29 Mar 2019 22:51:14 +0300
Subject: [PATCH 3/4] build_W5-Add-mkdir-ramdisk.patch

Change-Id: I4c79ec02cd3e54da8ef88a6fee28b0d066d49d40
---
 tools/releasetools/common.py                | 5 +++++
 tools/releasetools/ota_from_target_files.py | 3 +++
 2 files changed, 8 insertions(+)

diff --git a/tools/releasetools/common.py b/tools/releasetools/common.py
index 2bdf2a269..baac3ced8 100644
--- a/tools/releasetools/common.py
+++ b/tools/releasetools/common.py
@@ -1120,6 +1120,11 @@ class DeviceSpecificParams(object):
     used to install the image for the device's baseband processor."""
     return self._DoCall("FullOTA_InstallEnd")
 
+  def FullOTA_InstallNew(self):
+    """Called after installing and validating /ramdisk; typically this is
+    used to resize the ramdisk partition after a recovery installation."""
+    return self._DoCall("FullOTA_InstallNew")
+
   def FullOTA_PostValidate(self):
     """Called after installing and validating /system; typically this is
     used to resize the system partition after a block based installation."""
diff --git a/tools/releasetools/ota_from_target_files.py b/tools/releasetools/ota_from_target_files.py
index 7e0df56d8..1ccffdc4f 100755
--- a/tools/releasetools/ota_from_target_files.py
+++ b/tools/releasetools/ota_from_target_files.py
@@ -712,6 +712,9 @@ else if get_stage("%(bcb_dev)s") == "3/3" then
 
   device_specific.FullOTA_PostValidate()
 
+  script.ShowProgress(0.2, 10)
+  device_specific.FullOTA_InstallNew()
+
   if OPTIONS.backuptool:
     script.ShowProgress(0.02, 10)
     if block_based:
-- 
2.11.0

