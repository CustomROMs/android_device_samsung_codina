From 3ab89ab2dead5e5011479b284af6284ed4f63b87 Mon Sep 17 00:00:00 2001
From: olivieer <yves.olli@gmail.com>
Date: Sun, 29 Mar 2015 14:48:44 +0200
Subject: [PATCH 15/21] libril: Send fake event for manual network registration
 to unblock UI

---
 libril/ril_service.cpp | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/libril/ril_service.cpp b/libril/ril_service.cpp
index dcb9e99..165e4d5 100644
--- a/libril/ril_service.cpp
+++ b/libril/ril_service.cpp
@@ -1369,6 +1369,22 @@ Return<void> RadioImpl::setNetworkSelectionModeManual(int32_t serial,
 #endif
     dispatchString(serial, mSlotId, RIL_REQUEST_SET_NETWORK_SELECTION_MANUAL,
             operatorNumeric.c_str());
+
+    /**
+      * Qualcomm's RIL doesn't seem to issue any callbacks for opcode 47
+      * This may be a bug on how we call rild or simply some proprietary 'feature'
+      * ..and we don't care: We simply send a SUCCESS message back to the caller to
+      * indicate that we received the command & unblock the UI.
+      * The user will still see if the registration was OK by using the
+      * normal signal meter
+      */
+    RLOGE("setNetworkSelectionModeManual: sending fake success event");
+    RequestInfo *pRI = android::addRequestToList(serial, mSlotId,
+            RIL_REQUEST_SET_NETWORK_SELECTION_MANUAL);
+    if (pRI != NULL) {
+        RIL_onRequestComplete(pRI, RIL_E_SUCCESS, NULL, 0);
+    }
+
     return Void();
 }
 
-- 
2.11.0

