From 8ded2c4c345d0b75599010e4de3f93b072dd2537 Mon Sep 17 00:00:00 2001
From: Diogo Ferreira <diogo@underdev.org>
Date: Tue, 22 Dec 2015 10:22:49 +0000
Subject: [PATCH 07/21] Add a dummy implementation of the ALLOW_DATA request to
 play nice with telephony expectations.

---
 reference-ril/reference-ril.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/reference-ril/reference-ril.c b/reference-ril/reference-ril.c
index 084c4ad..825cc7e 100644
--- a/reference-ril/reference-ril.c
+++ b/reference-ril/reference-ril.c
@@ -2027,6 +2027,11 @@ static void requestSetupDataCall(void *data, size_t datalen, RIL_Token t)
             pdp_type = "IP";
         }
 
+        if (!strcmp("IPV6", pdp_type)) {
+            RLOGW("IPV6 pdp requested, but reference ril only supports IPV4, downgrading.");
+            pdp_type = "IP";
+        }
+
         asprintf(&cmd, "AT+CGDCONT=1,\"%s\",\"%s\",,0,0", pdp_type, apn);
         //FIXME check for error here
         err = at_send_command(cmd, NULL);
@@ -2454,6 +2459,10 @@ onRequest (int request, void *data, size_t datalen, RIL_Token t)
                 RIL_onRequestComplete(t, RIL_E_SUCCESS, NULL, 0);
             }
             break;
+        case RIL_REQUEST_ALLOW_DATA:
+            /* Just return success. */
+            RIL_onRequestComplete(t, RIL_E_SUCCESS, NULL, 0);
+            break;
 
         case RIL_REQUEST_SEPARATE_CONNECTION:
             {
-- 
2.11.0

