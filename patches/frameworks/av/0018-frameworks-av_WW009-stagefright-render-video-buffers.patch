From b1968d9bf0c25626db36c43fb33c16a10c14f979 Mon Sep 17 00:00:00 2001
From: Shilin Victor <radicaldreamer00001@gmail.com>
Date: Fri, 29 Mar 2019 22:51:38 +0300
Subject: [PATCH 18/45] 
 frameworks-av_WW009-stagefright-render-video-buffers.patch

Change-Id: Ie4ce353771a3048b38ea8c058261089539b911ee
---
 cmds/stagefright/Android.mk      | 2 +-
 cmds/stagefright/stagefright.cpp | 6 ++++++
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/cmds/stagefright/Android.mk b/cmds/stagefright/Android.mk
index 20c00948f..f3b8f1012 100644
--- a/cmds/stagefright/Android.mk
+++ b/cmds/stagefright/Android.mk
@@ -9,7 +9,7 @@ LOCAL_SRC_FILES:=       \
 
 LOCAL_SHARED_LIBRARIES := \
 	libstagefright libmedia libutils libbinder libstagefright_foundation \
-        libjpeg libgui libcutils liblog
+        libjpeg libgui libcutils liblog libui
 
 LOCAL_C_INCLUDES:= \
 	frameworks/av/media/libstagefright \
diff --git a/cmds/stagefright/stagefright.cpp b/cmds/stagefright/stagefright.cpp
index a9c6edacd..ea8a88eb6 100644
--- a/cmds/stagefright/stagefright.cpp
+++ b/cmds/stagefright/stagefright.cpp
@@ -342,6 +342,12 @@ static void playSource(OMXClient *client, sp<MediaSource> &source) {
                     printf(".");
                     fflush(stdout);
                 }
+
+                // render buffers from OMXCodec
+                if (buffer->graphicBuffer() != NULL && gSurface != NULL) {
+                    gSurface->queueBuffer(gSurface.get(), buffer->graphicBuffer()->getNativeBuffer(), -1);
+                    buffer->meta_data()->setInt32(kKeyRendered, 1);
+                }
             }
 
             sumDecodeUs += delayDecodeUs;
-- 
2.11.0

