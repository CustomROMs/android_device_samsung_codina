From b235854ddb5b5eea4bd51f8d0ba1dd4c8660dbbe Mon Sep 17 00:00:00 2001
From: Shilin Victor <chrono.monochrome@gmail.com>
Date: Mon, 10 Sep 2018 10:44:44 +0300
Subject: [PATCH 17/26] libaudiohal: fix build errors

Change-Id: I22a4a5f9e0ce07fda243c1eec713421c58882744
---
 media/libaudiohal/2.0/EffectHalLocal.h                                | 1 +
 media/libaudiohal/4.0/include/libaudiohal/4.0/EffectsFactoryHalHidl.h | 4 ++--
 media/libaudiohal/Android.bp                                          | 2 ++
 media/libaudiohal/EffectBufferHalLocal.h                              | 1 +
 services/audioflinger/Android.mk                                      | 1 +
 5 files changed, 7 insertions(+), 2 deletions(-)
 create mode 120000 media/libaudiohal/2.0/EffectHalLocal.h

diff --git a/media/libaudiohal/2.0/EffectHalLocal.h b/media/libaudiohal/2.0/EffectHalLocal.h
new file mode 120000
index 000000000..56c70c409
--- /dev/null
+++ b/media/libaudiohal/2.0/EffectHalLocal.h
@@ -0,0 +1 @@
+../EffectHalLocal.h
\ No newline at end of file
diff --git a/media/libaudiohal/4.0/include/libaudiohal/4.0/EffectsFactoryHalHidl.h b/media/libaudiohal/4.0/include/libaudiohal/4.0/EffectsFactoryHalHidl.h
index 680b7a132..7cad068cb 100644
--- a/media/libaudiohal/4.0/include/libaudiohal/4.0/EffectsFactoryHalHidl.h
+++ b/media/libaudiohal/4.0/include/libaudiohal/4.0/EffectsFactoryHalHidl.h
@@ -52,9 +52,9 @@ class EffectsFactoryHalHidl : public EffectsFactoryHalInterface, public Conversi
 
     virtual status_t dumpEffects(int fd);
 
-    status_t allocateBuffer(size_t size, sp<EffectBufferHalInterface>* buffer) override;
+    status_t allocateBuffer(size_t size, sp<EffectBufferHalInterface>* buffer);
     status_t mirrorBuffer(void* external, size_t size,
-                          sp<EffectBufferHalInterface>* buffer) override;
+                          sp<EffectBufferHalInterface>* buffer);
 
   private:
     friend class EffectsFactoryHalInterface;
diff --git a/media/libaudiohal/Android.bp b/media/libaudiohal/Android.bp
index 9be8ceb74..98572f783 100644
--- a/media/libaudiohal/Android.bp
+++ b/media/libaudiohal/Android.bp
@@ -18,6 +18,8 @@ cc_library_shared {
         "android.hardware.audio.effect@4.0",
         "android.hardware.audio@2.0",
         "android.hardware.audio@4.0",
+        "libeffects",
+        "liblog",
         "libaudiohal@2.0",
         "libaudiohal@4.0",
         "libutils",
diff --git a/media/libaudiohal/EffectBufferHalLocal.h b/media/libaudiohal/EffectBufferHalLocal.h
index d2b624b0e..2335e35e0 100644
--- a/media/libaudiohal/EffectBufferHalLocal.h
+++ b/media/libaudiohal/EffectBufferHalLocal.h
@@ -29,6 +29,7 @@ class EffectBufferHalLocal : public EffectBufferHalInterface
   public:
     virtual audio_buffer_t* audioBuffer();
     virtual void* externalData() const;
+    virtual size_t getSize() const override { return mBufferSize; }
 
     virtual void setExternalData(void* external);
     virtual void setFrameCount(size_t frameCount);
diff --git a/services/audioflinger/Android.mk b/services/audioflinger/Android.mk
index 7419e648c..d0ec2d0c8 100644
--- a/services/audioflinger/Android.mk
+++ b/services/audioflinger/Android.mk
@@ -40,6 +40,7 @@ LOCAL_C_INCLUDES := \
 
 LOCAL_SHARED_LIBRARIES := \
     libaudiohal \
+    libaudiohal@2.0 \
     libaudioprocessing \
     libaudiospdif \
     libaudioutils \
-- 
2.11.0

