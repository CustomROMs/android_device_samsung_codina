From a7a5cbff8bd69b03184eb722346a3f1d8b341440 Mon Sep 17 00:00:00 2001
From: antirez <antirez@gmail.com>
Date: Wed, 5 Jul 2017 15:40:25 +0200
Subject: [PATCH 06/11] Avoid closing invalid fds

These fds can be invalid if, for example, we fail to open ns/mnt.
---
 VolumeManager.cpp | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/VolumeManager.cpp b/VolumeManager.cpp
index 58da887..720098e 100644
--- a/VolumeManager.cpp
+++ b/VolumeManager.cpp
@@ -562,8 +562,12 @@ int VolumeManager::remountUid(uid_t uid, const std::string& mode) {
         }
 
 next:
-        close(nsFd);
-        close(pidFd);
+        if (nsFd >= 0) {
+            close(nsFd);
+        }
+        if (pidFd >= 0) {
+            close(pidFd);
+        }
     }
     closedir(dir);
     return 0;
-- 
2.11.0

