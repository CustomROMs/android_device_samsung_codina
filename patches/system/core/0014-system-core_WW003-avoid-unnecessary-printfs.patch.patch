From 475c90487e202e2f6c69a72513461a33bb40f737 Mon Sep 17 00:00:00 2001
From: Shilin Victor <radicaldreamer00001@gmail.com>
Date: Fri, 29 Mar 2019 22:55:20 +0300
Subject: [PATCH 14/20] system-core_WW003-avoid-unnecessary-printfs.patch

Change-Id: I469884aaaa8dc08034de400c05e8b7150124fe27
---
 init/log.cpp     | 2 ++
 libcutils/klog.c | 1 +
 2 files changed, 3 insertions(+)

diff --git a/init/log.cpp b/init/log.cpp
index d32f2dae8..85f9d3ccb 100644
--- a/init/log.cpp
+++ b/init/log.cpp
@@ -25,6 +25,8 @@
 static void init_klog_vwrite(int level, const char* fmt, va_list ap) {
     static const char* tag = basename(getprogname());
 
+    if (level > klog_get_level()) return;
+
     char prefix[64];
     snprintf(prefix, sizeof(prefix), "<%d>%s: ", level, tag);
 
diff --git a/libcutils/klog.c b/libcutils/klog.c
index 710dc6669..7402903ea 100644
--- a/libcutils/klog.c
+++ b/libcutils/klog.c
@@ -62,6 +62,7 @@ void klog_writev(int level, const struct iovec* iov, int iov_count) {
 }
 
 void klog_write(int level, const char* fmt, ...) {
+    if (level > klog_level) return;
     char buf[LOG_BUF_MAX];
     va_list ap;
     va_start(ap, fmt);
-- 
2.11.0

